{"title":"PVE 虚拟环境下 LEDE 软路由&黑群晖一体机搭建踩坑实录","uid":"071e075cf4eb65abed3b589cda67a89f","slug":"PVE虚拟环境LEDE软路由-黑群晖一体机搭建踩坑实录","date":"2020-02-21T11:57:07.000Z","updated":"2021-08-19T06:18:57.964Z","comments":true,"path":"api/articles/PVE虚拟环境LEDE软路由-黑群晖一体机搭建踩坑实录.json","keywords":null,"cover":"https://image-assets.mihuashi.com/2021/08/14/00/Fi7W8zObmWFkqpT-FOAoHgVXNwkl.jpeg","content":"<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">蜜汁吐槽</p>\n<p>奇怪的运营商司马增加了</p>\n</div>\n<p>本文主要记录了在一台老 Intel 笔记本上安装 PVE 系统，部署 LEDE 软路由（主路由）以及黑群晖的瞎折腾过程。</p>\n<span id=\"more\"></span>\n\n<p>整个网络结构的规划为：光纤 -&gt; 光猫（桥接）-&gt; 交换机（有线终端接入）-&gt; 无线 AP（无线终端接入）-&gt; PVE Linux Bridge -&gt; LEDE 软路由 -&gt; 黑群晖 NAS。</p>\n<h2 id=\"PVE-安装\"><a href=\"#PVE-安装\" class=\"headerlink\" title=\"PVE 安装\"></a>PVE 安装</h2><p>在 <a href=\"https://www.proxmox.com/en/downloads\">Proxmox 网站</a>获取最新的镜像文件，使用 <a href=\"https://rufus.ie/\">Rufus</a> 刷写到 U 盘中，<strong>刷写模式选择 DD</strong>（否则会提示找不到启动设备）。</p>\n<p>写入完成以后拨下U盘，拿到安装 PVE 的主机上插入 USB 口，开机进 BIOS，确认 <strong>VT-D 已经开启</strong>，选U盘启动（UEFI方式）。</p>\n<h3 id=\"第一次启动翻车\"><a href=\"#第一次启动翻车\" class=\"headerlink\" title=\"第一次启动翻车\"></a>第一次启动翻车</h3><p>第一次启动时出现了如下情况：</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">error:unknown filesystem\nerror:unknown filesystem\nerror:unknown filesystem\n...\ngrub rescue&gt;</code></pre>\n\n<p>这是由于 grub 版本不匹配导致的，可以试着用 Rufus 重新刷写一遍更新 grub，或者输入以下指令。</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">grub rescue&gt;ls  #查看分区\ngrub rescue&gt;ls(hd0,...)  #如果依旧是 unknown filesystem 则换下一个分区\n...\ngrub rescue&gt;ls(hd1,...)  #找到了\n#修改启动分区\ngrub rescue&gt;root&#x3D;hd1,...    #分区名\ngrub rescue&gt;prefix&#x3D;&#x2F;boot&#x2F;grub\ngrub rescue&gt;set root&#x3D;(hd1,...)\ngrub rescue&gt;insmod normal\n\ngrub rescue&gt;normal  #进入启动菜单，按 C 进入命令行\ngrub&gt;set root&#x3D;hd1,...    #分区名\ngrub&gt;set prefix&#x3D;(hd1,...)&#x2F;boot&#x2F;grub\ngrub&gt;linux &#x2F;vmlinuz root&#x3D;&#x2F;dev&#x2F;sda*\ngrub&gt;initrd &#x2F;initrd.img\ngrub&gt;boot</code></pre>\n\n<p>等进入系统后修复 grub。</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">sudo update-grub</code></pre>\n\n<h3 id=\"后续安装\"><a href=\"#后续安装\" class=\"headerlink\" title=\"后续安装\"></a>后续安装</h3><p>Proxmox 有很友好的界面安装过程，基本无脑下一步就行，但需要注意在IP、掩码、网关设置页填写与你连接终端在同一网段的 IP 地址，此地址也是之后登录控制台的地址。</p>\n<p><img src=\"PVE%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83LEDE%E8%BD%AF%E8%B7%AF%E7%94%B1-%E9%BB%91%E7%BE%A4%E6%99%96%E4%B8%80%E4%BD%93%E6%9C%BA%E6%90%AD%E5%BB%BA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95/cb0d8541790c5d603a469713a25cdf25.jpg\"></p>\n<p>Hostname 随意填写就行。</p>\n<p>安装完成后，拔下 U 盘，重启即可。</p>\n<p>启动以后就会出现登陆信息提示，也就是控制台的 URL 访问地址，你可以用另外一台局域网内的电脑输入这个 URL 即能访问 PVE 的控制台：</p>\n<p>比如我的是：<code>https://192.168.1.100:8006</code>（记住是https而不是http）</p>\n<h3 id=\"关于更改-PVE-主机的-IP-地址\"><a href=\"#关于更改-PVE-主机的-IP-地址\" class=\"headerlink\" title=\"关于更改 PVE 主机的 IP 地址\"></a>关于更改 PVE 主机的 IP 地址</h3><p>用 SSH 连接到 PVE 主机，输入</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">vi &#x2F;etc&#x2F;network&#x2F;interfaces</code></pre>\n\n<p>修改文件中的 <code>address</code> 和 <code>gateway</code>。</p>\n<p>保存退出，输入</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">vi &#x2F;etc&#x2F;issue</code></pre>\n\n<p>修改文件中 <code>https://新IP:8006</code>。</p>\n<p>保存退出，输入</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">vi &#x2F;etc&#x2F;hosts</code></pre>\n\n<p>修改第 2 行的 IP 地址，保存退出，重启即可。</p>\n<h3 id=\"关于笔记本下-PVE-盒盖自动休眠\"><a href=\"#关于笔记本下-PVE-盒盖自动休眠\" class=\"headerlink\" title=\"关于笔记本下 PVE 盒盖自动休眠\"></a>关于笔记本下 PVE 盒盖自动休眠</h3><p>编辑 <code>/etc/systemd/logind.conf</code></p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">#HandlePowerKey按下电源键后的行为，默认power off\n#HandleSleepKey 按下挂起键后的行为，默认suspend\n#HandleHibernateKey按下休眠键后的行为，默认hibernate\n#HandleLidSwitch合上笔记本盖后的行为，默认suspend（改为ignore；即合盖不休眠）在原文件中，还要去掉前面的#</code></pre>\n\n<p>重启服务</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">service systemd-logind restart</code></pre>\n\n<h2 id=\"安装-LEDE-OpenWrt-软路由\"><a href=\"#安装-LEDE-OpenWrt-软路由\" class=\"headerlink\" title=\"安装 LEDE/OpenWrt 软路由\"></a>安装 LEDE/OpenWrt 软路由</h2><h3 id=\"创建虚拟机\"><a href=\"#创建虚拟机\" class=\"headerlink\" title=\"创建虚拟机\"></a>创建虚拟机</h3><p>进入 PVE 控制台，点击“创建虚拟机”按钮，勾上“高级”，勾上“开机自启动”（软路由一般情况下开机启动），名称填入虚拟机名称（例如 LEDE），点击“下一步”。</p>\n<p><img src=\"PVE%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83LEDE%E8%BD%AF%E8%B7%AF%E7%94%B1-%E9%BB%91%E7%BE%A4%E6%99%96%E4%B8%80%E4%BD%93%E6%9C%BA%E6%90%AD%E5%BB%BA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95/247cdbf0c598d89172ef40bc930bd9ee.png\"></p>\n<p>操作系统选择“Linux”，版本选择“4.X/3.X/2.6 Kernel”即可，选择“不适用任何介质”，点击“下一步”。</p>\n<p><img src=\"PVE%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83LEDE%E8%BD%AF%E8%B7%AF%E7%94%B1-%E9%BB%91%E7%BE%A4%E6%99%96%E4%B8%80%E4%BD%93%E6%9C%BA%E6%90%AD%E5%BB%BA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95/dd2ab19ec71b2ad71929469dd09920f8.png\"></p>\n<p>硬盘默认即可，CPU按实际情况分配，内存512MB 即可。</p>\n<p>网络页确认桥接的设备是否正确，模型选择“VirtIO (半虚拟化)”（注意此网卡在 LEDE 界面中不会被正确识别，但实际是能够使用的），关闭防火墙（勾去掉），点击“下一步”。</p>\n<p><img src=\"PVE%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83LEDE%E8%BD%AF%E8%B7%AF%E7%94%B1-%E9%BB%91%E7%BE%A4%E6%99%96%E4%B8%80%E4%BD%93%E6%9C%BA%E6%90%AD%E5%BB%BA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95/Capture.png\"></p>\n<p>确认页确认无误，点击“完成”。</p>\n<h3 id=\"删除不需要的硬件\"><a href=\"#删除不需要的硬件\" class=\"headerlink\" title=\"删除不需要的硬件\"></a>删除不需要的硬件</h3><p>选择“LEDE” –&gt; “硬件”，找到默认创建的硬盘，选中点击“分离”。</p>\n<p><img src=\"PVE%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83LEDE%E8%BD%AF%E8%B7%AF%E7%94%B1-%E9%BB%91%E7%BE%A4%E6%99%96%E4%B8%80%E4%BD%93%E6%9C%BA%E6%90%AD%E5%BB%BA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95/1a4de83d482cf4a1114afeef79b84ca7.png\"></p>\n<p>硬盘分离后，选中未使用的磁盘0，点击“删除”。</p>\n<p><img src=\"PVE%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83LEDE%E8%BD%AF%E8%B7%AF%E7%94%B1-%E9%BB%91%E7%BE%A4%E6%99%96%E4%B8%80%E4%BD%93%E6%9C%BA%E6%90%AD%E5%BB%BA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95/0ea39ae95113d9ce09201a35059105e7.png\"></p>\n<p>同样的方法，也可将光驱删除掉（删除光驱不需要分离）。</p>\n<h3 id=\"安装系统\"><a href=\"#安装系统\" class=\"headerlink\" title=\"安装系统\"></a>安装系统</h3><p>在 <a href=\"https://firmware.koolshare.cn/LEDE_X64_fw867/%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BD%AC%E7%9B%98%E6%88%96PE%E4%B8%8B%E5%86%99%E7%9B%98%E4%B8%93%E7%94%A8/\">Koolshare 论坛</a>获取 .gz 格式的文件，用 7-zip 解压，得到 <code>.img</code> 镜像文件，使用 SFTP 将镜像文件上传到 PVE 的 <code>root</code> 根目录。</p>\n<p>将 <code>.img</code> 的 <code>RAW</code> 文件转换为 <code>qcow2</code> 格式的文件，并添加到磁盘。（也可以 <code>.img</code> 文件直接添加到磁盘中，磁盘性能会有增加，但不能使用快照之类虚拟机相关的功能）</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">qemu-img convert -f raw -O qcow2 *.img *.qcow2\nqemu-img check *.qcow2  #检查文件完整\nqm importdisk 100 *.qcow2 local-lvm  #添加到磁盘，100为对应的虚拟机编号</code></pre>\n\n<p>选择“LEDE” –&gt; “硬件”，双击“未使用的磁盘0”，选择总线/设备为 SATA，点击“添加”。</p>\n<p>顺便再添加一个网口，点击左上“添加”选项卡，选择“网络设备”，模型选择“VirtIO (半虚拟化)”，点击“添加”。</p>\n<p><img src=\"PVE%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83LEDE%E8%BD%AF%E8%B7%AF%E7%94%B1-%E9%BB%91%E7%BE%A4%E6%99%96%E4%B8%80%E4%BD%93%E6%9C%BA%E6%90%AD%E5%BB%BA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95/Capture2.png\"></p>\n<p>选择“LEDE” –&gt; “选项”，修改启动顺序第一为硬盘启动。</p>\n<p><img src=\"PVE%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83LEDE%E8%BD%AF%E8%B7%AF%E7%94%B1-%E9%BB%91%E7%BE%A4%E6%99%96%E4%B8%80%E4%BD%93%E6%9C%BA%E6%90%AD%E5%BB%BA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95/Capture3.png\"></p>\n<p>至此虚拟机系统安装结束。</p>\n<h3 id=\"启动与配置\"><a href=\"#启动与配置\" class=\"headerlink\" title=\"启动与配置\"></a>启动与配置</h3><p>启动虚拟机，点击“控制台”。</p>\n<p><img src=\"PVE%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83LEDE%E8%BD%AF%E8%B7%AF%E7%94%B1-%E9%BB%91%E7%BE%A4%E6%99%96%E4%B8%80%E4%BD%93%E6%9C%BA%E6%90%AD%E5%BB%BA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95/Capture4.png\"></p>\n<p>修改网络配置文件，输入</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">vi &#x2F;etc&#x2F;config&#x2F;network</code></pre>\n\n<p>重启网络</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">&#x2F;etc&#x2F;init.d&#x2F;network restart</code></pre>\n\n<p>在浏览器端通过配置后的 IP 地址登录路由器，默认密码 koolshare。</p>\n<p>若要配置软路由为旁路由，参考<a href=\"https://koolshare.cn/thread-166027-1-1.html\">此处</a>。</p>\n<p>若要给软路由手动挂载硬盘，并开启 smb 服务，参考<a href=\"https://koolshare.cn/thread-110543-1-1.html\">此处</a>。</p>\n<h3 id=\"光猫改桥接\"><a href=\"#光猫改桥接\" class=\"headerlink\" title=\"光猫改桥接\"></a>光猫改桥接</h3><p>登录光猫后台，按下图配置新建一个 WAN 连接。</p>\n<p><img src=\"PVE%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83LEDE%E8%BD%AF%E8%B7%AF%E7%94%B1-%E9%BB%91%E7%BE%A4%E6%99%96%E4%B8%80%E4%BD%93%E6%9C%BA%E6%90%AD%E5%BB%BA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95/Capture5.png\"></p>\n<p>关闭 DHCP，发送短信到10086重置宽带密码即可。</p>\n<h2 id=\"安装黑群晖\"><a href=\"#安装黑群晖\" class=\"headerlink\" title=\"安装黑群晖\"></a>安装黑群晖</h2><h3 id=\"创建虚拟机-1\"><a href=\"#创建虚拟机-1\" class=\"headerlink\" title=\"创建虚拟机\"></a>创建虚拟机</h3><p>进入 PVE 控制台，点击“创建虚拟机”按钮，勾上“高级”，勾上“开机自启动”（软路由一般情况下开机启动），名称填入虚拟机名称（例如 DSM），点击“下一步”。</p>\n<p><img src=\"PVE%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83LEDE%E8%BD%AF%E8%B7%AF%E7%94%B1-%E9%BB%91%E7%BE%A4%E6%99%96%E4%B8%80%E4%BD%93%E6%9C%BA%E6%90%AD%E5%BB%BA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95/d1ae14ba3924a4f99aac7644dd97aa78-1.png\"></p>\n<p>操作系统选择“Linux”，版本选择“4.X/3.X/2.6 Kernel”即可，选择“不适用任何介质”，点击“下一步”。</p>\n<p><img src=\"PVE%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83LEDE%E8%BD%AF%E8%B7%AF%E7%94%B1-%E9%BB%91%E7%BE%A4%E6%99%96%E4%B8%80%E4%BD%93%E6%9C%BA%E6%90%AD%E5%BB%BA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95/dd2ab19ec71b2ad71929469dd09920f8.png\"></p>\n<p>硬盘默认即可，CPU按实际情况分配，内存2GB 足够，也可按实际情况增加到8 GB。</p>\n<p>网络页确认桥接的设备是否正确，模型选择“Intel E1000”（半虚拟化网卡会导致无法连接到 NAS），关闭防火墙（勾去掉），点击“下一步”。</p>\n<p>确认页确认无误，点击“完成”。</p>\n<h3 id=\"删除不需要的硬件-1\"><a href=\"#删除不需要的硬件-1\" class=\"headerlink\" title=\"删除不需要的硬件\"></a>删除不需要的硬件</h3><p>选择“LEDE” –&gt; “硬件”，找到默认创建的硬盘，选中点击“分离”。</p>\n<p><img src=\"PVE%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83LEDE%E8%BD%AF%E8%B7%AF%E7%94%B1-%E9%BB%91%E7%BE%A4%E6%99%96%E4%B8%80%E4%BD%93%E6%9C%BA%E6%90%AD%E5%BB%BA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95/1a4de83d482cf4a1114afeef79b84ca7.png\"></p>\n<p>硬盘分离后，选中未使用的磁盘0，点击“删除”。</p>\n<p><img src=\"PVE%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83LEDE%E8%BD%AF%E8%B7%AF%E7%94%B1-%E9%BB%91%E7%BE%A4%E6%99%96%E4%B8%80%E4%BD%93%E6%9C%BA%E6%90%AD%E5%BB%BA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95/0ea39ae95113d9ce09201a35059105e7.png\"></p>\n<p>同样的方法，也可将光驱删除掉（删除光驱不需要分离）。</p>\n<p>注意：如果要拆掉已部署好的虚拟机 NAS 硬盘，先在 PVE 控制台中将硬盘分离，再将硬盘从机器上拆下，以免虚拟机无法进入系统。</p>\n<h3 id=\"注入引导\"><a href=\"#注入引导\" class=\"headerlink\" title=\"注入引导\"></a>注入引导</h3><p>准备好引导文件和对应系统（<code>.pat</code>）文件，将 <code>.img</code> 的 <code>RAW</code> 引导文件转换为 <code>qcow2</code> 格式的文件，并添加到磁盘。（也可以 <code>.img</code> 文件直接添加到磁盘中，磁盘性能会有增加，但不能使用快照之类虚拟机相关的功能）</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">qemu-img convert -f raw -O qcow2 *.img *.qcow2\nqemu-img check *.qcow2  #检查文件完整\nqm importdisk 101 *.qcow2 local-lvm  #添加到磁盘，101为对应的虚拟机编号</code></pre>\n\n<p>选择“硬件”，双击“未使用的磁盘0”，选择总线/设备为 SATA，点击“添加”。</p>\n<p>选择“选项”，修改启动顺序第一为硬盘 <code>sata0</code> 启动。</p>\n<h3 id=\"硬盘直通\"><a href=\"#硬盘直通\" class=\"headerlink\" title=\"硬盘直通\"></a>硬盘直通</h3><p>搜索要直通硬盘的名字</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">ls -l &#x2F;dev&#x2F;disk&#x2F;by-id&#x2F;</code></pre>\n\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">total 0\nlrwxrwxrwx 1 root root  9 Feb 18 15:22 ata-ADATA_SU600_2H2920059140 -&gt; ..&#x2F;..&#x2F;sda\nlrwxrwxrwx 1 root root 10 Feb 18 15:22 ata-ADATA_SU600_2H2920059140-part1 -&gt; ..&#x2F;..&#x2F;sda1\nlrwxrwxrwx 1 root root 10 Feb 18 15:22 ata-ADATA_SU600_2H2920059140-part2 -&gt; ..&#x2F;..&#x2F;sda2\nlrwxrwxrwx 1 root root 10 Feb 18 17:43 ata-ADATA_SU600_2H2920059140-part3 -&gt; ..&#x2F;..&#x2F;sda3\nlrwxrwxrwx 1 root root  9 Feb 20 09:48 ata-HL-DT-ST_DVDRAM_GUA0N_M3HDBE92146 -&gt; ..&#x2F;..&#x2F;sr0\nlrwxrwxrwx 1 root root 10 Feb 18 15:22 dm-name-pve-root -&gt; ..&#x2F;..&#x2F;dm-1\nlrwxrwxrwx 1 root root 10 Feb 18 15:22 dm-name-pve-swap -&gt; ..&#x2F;..&#x2F;dm-0\nlrwxrwxrwx 1 root root 10 Feb 18 15:22 dm-name-pve-vm--100--disk--0 -&gt; ..&#x2F;..&#x2F;dm-6\nlrwxrwxrwx 1 root root 10 Feb 21 10:44 dm-name-pve-vm--101--disk--0 -&gt; ..&#x2F;..&#x2F;dm-7\nlrwxrwxrwx 1 root root 10 Feb 18 15:22 dm-uuid-LVM-Y6rOQSEmx7NnZGSxyFMCeQuQZMV4j8cT3vbIcOrPhnw3uBZEDn5Lddpq3bAhtCyA -&gt; ..&#x2F;..&#x2F;dm-1\nlrwxrwxrwx 1 root root 10 Feb 18 15:22 dm-uuid-LVM-Y6rOQSEmx7NnZGSxyFMCeQuQZMV4j8cTf2hYrl4cwr7Keb4NjQyQHm2TwT5uNKCk -&gt; ..&#x2F;..&#x2F;dm-6\nlrwxrwxrwx 1 root root 10 Feb 18 15:22 dm-uuid-LVM-Y6rOQSEmx7NnZGSxyFMCeQuQZMV4j8cThddROH8Cwqq1WN2qZIdA76EY5xBPF0b6 -&gt; ..&#x2F;..&#x2F;dm-0\nlrwxrwxrwx 1 root root 10 Feb 21 10:44 dm-uuid-LVM-Y6rOQSEmx7NnZGSxyFMCeQuQZMV4j8cTmUj5qVbEQBOnbVbxql3ZPDVy8ho3fmVU -&gt; ..&#x2F;..&#x2F;dm-7\nlrwxrwxrwx 1 root root 10 Feb 18 17:43 lvm-pv-uuid-Zkz9vg-u9rg-lztZ-mkgI-EsLe-1zs8-ayPXHo -&gt; ..&#x2F;..&#x2F;sda3\nlrwxrwxrwx 1 root root  9 Feb 21 08:03 usb-Seagate_BUP_Slim_GD_NA7YCVF6-0:0 -&gt; ..&#x2F;..&#x2F;sdc\nlrwxrwxrwx 1 root root 10 Feb 21 08:03 usb-Seagate_BUP_Slim_GD_NA7YCVF6-0:0-part1 -&gt; ..&#x2F;..&#x2F;sdc1\nlrwxrwxrwx 1 root root 10 Feb 21 08:03 usb-Seagate_BUP_Slim_GD_NA7YCVF6-0:0-part2 -&gt; ..&#x2F;..&#x2F;sdc2\nlrwxrwxrwx 1 root root 10 Feb 21 08:03 usb-Seagate_BUP_Slim_GD_NA7YCVF6-0:0-part3 -&gt; ..&#x2F;..&#x2F;sdc3\nlrwxrwxrwx 1 root root 10 Feb 21 08:03 usb-Seagate_BUP_Slim_GD_NA7YCVF6-0:0-part5 -&gt; ..&#x2F;..&#x2F;sdc5\nlrwxrwxrwx 1 root root  9 Feb 20 09:48 wwn-0x5001480000000000 -&gt; ..&#x2F;..&#x2F;sr0\nlrwxrwxrwx 1 root root  9 Feb 18 15:22 wwn-0x5707c1810054afc4 -&gt; ..&#x2F;..&#x2F;sda\nlrwxrwxrwx 1 root root 10 Feb 18 15:22 wwn-0x5707c1810054afc4-part1 -&gt; ..&#x2F;..&#x2F;sda1\nlrwxrwxrwx 1 root root 10 Feb 18 15:22 wwn-0x5707c1810054afc4-part2 -&gt; ..&#x2F;..&#x2F;sda2\nlrwxrwxrwx 1 root root 10 Feb 18 17:43 wwn-0x5707c1810054afc4-part3 -&gt; ..&#x2F;..&#x2F;sda3</code></pre>\n\n<p>SATA 硬盘前缀为 <code>ata</code>，USB 硬盘前缀为 <code>usb</code>，这里以直通1T 希捷移动硬盘为例，查询到硬盘目录为 <code>usb-Seagate_BUP_Slim_GD_NA7YCVF6-0:0</code>，输入命令</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">qm set 101 -sata1 &#x2F;dev&#x2F;disk&#x2F;by-id&#x2F;usb-Seagate_BUP_Slim_GD_NA7YCVF6-0:0  #101为直通虚拟机编号</code></pre>\n\n<p>便会自动给 101 号虚拟机添加一块编号 sata1 的硬盘。</p>\n<h3 id=\"安装系统-1\"><a href=\"#安装系统-1\" class=\"headerlink\" title=\"安装系统\"></a>安装系统</h3><p>启动虚拟机，待控制台中显示</p>\n<p><img src=\"PVE%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83LEDE%E8%BD%AF%E8%B7%AF%E7%94%B1-%E9%BB%91%E7%BE%A4%E6%99%96%E4%B8%80%E4%BD%93%E6%9C%BA%E6%90%AD%E5%BB%BA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95/Capture6.png\"></p>\n<p>在浏览器输入网址 <code>find.synology.com</code>，执行系统初始化。</p>\n<p><img src=\"https://wp.qiniu.gxnas.com/wp-content/uploads/2019/07/fade2769fa530d6ad00510fb75bbe6f4.png\"></p>\n<p><img src=\"PVE%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83LEDE%E8%BD%AF%E8%B7%AF%E7%94%B1-%E9%BB%91%E7%BE%A4%E6%99%96%E4%B8%80%E4%BD%93%E6%9C%BA%E6%90%AD%E5%BB%BA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95/cf8674d61200f52c58330d8b2ec72f1b.png\"></p>\n<p>选择手动安装，选择对应的系统文件，过几分钟后就会自动进入 NAS 的主界面。</p>\n<p><img src=\"https://wp.qiniu.gxnas.com/wp-content/uploads/2019/07/a7a658886a85ecf5826dd2b37f02e9b7.png\"></p>\n","text":" 蜜汁吐槽 奇怪的运营商司马增加了 本文主要记录了在一台老 Intel 笔记本上安装 PVE 系统，部署 LEDE 软路由（主路由）以及黑群晖的瞎折腾过程。 整个网络结构的规划为：光纤 -&gt; 光猫（桥接）-&gt; 交换机（有线终端接入）-&gt; 无线 AP（无线终端接入...","link":"","photos":[],"count_time":{"symbolsCount":"6.7k","symbolsTime":"6 mins."},"categories":[{"name":"技术","slug":"技术","count":2,"path":"api/categories/技术.json"}],"tags":[{"name":"网络技术","slug":"网络技术","count":2,"path":"api/tags/网络技术.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#PVE-%E5%AE%89%E8%A3%85\"><span class=\"toc-text\">PVE 安装</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%AC%AC%E4%B8%80%E6%AC%A1%E5%90%AF%E5%8A%A8%E7%BF%BB%E8%BD%A6\"><span class=\"toc-text\">第一次启动翻车</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%90%8E%E7%BB%AD%E5%AE%89%E8%A3%85\"><span class=\"toc-text\">后续安装</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%85%B3%E4%BA%8E%E6%9B%B4%E6%94%B9-PVE-%E4%B8%BB%E6%9C%BA%E7%9A%84-IP-%E5%9C%B0%E5%9D%80\"><span class=\"toc-text\">关于更改 PVE 主机的 IP 地址</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%85%B3%E4%BA%8E%E7%AC%94%E8%AE%B0%E6%9C%AC%E4%B8%8B-PVE-%E7%9B%92%E7%9B%96%E8%87%AA%E5%8A%A8%E4%BC%91%E7%9C%A0\"><span class=\"toc-text\">关于笔记本下 PVE 盒盖自动休眠</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85-LEDE-OpenWrt-%E8%BD%AF%E8%B7%AF%E7%94%B1\"><span class=\"toc-text\">安装 LEDE&#x2F;OpenWrt 软路由</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA\"><span class=\"toc-text\">创建虚拟机</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%88%A0%E9%99%A4%E4%B8%8D%E9%9C%80%E8%A6%81%E7%9A%84%E7%A1%AC%E4%BB%B6\"><span class=\"toc-text\">删除不需要的硬件</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85%E7%B3%BB%E7%BB%9F\"><span class=\"toc-text\">安装系统</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%90%AF%E5%8A%A8%E4%B8%8E%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">启动与配置</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%85%89%E7%8C%AB%E6%94%B9%E6%A1%A5%E6%8E%A5\"><span class=\"toc-text\">光猫改桥接</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85%E9%BB%91%E7%BE%A4%E6%99%96\"><span class=\"toc-text\">安装黑群晖</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA-1\"><span class=\"toc-text\">创建虚拟机</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%88%A0%E9%99%A4%E4%B8%8D%E9%9C%80%E8%A6%81%E7%9A%84%E7%A1%AC%E4%BB%B6-1\"><span class=\"toc-text\">删除不需要的硬件</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%B3%A8%E5%85%A5%E5%BC%95%E5%AF%BC\"><span class=\"toc-text\">注入引导</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%A1%AC%E7%9B%98%E7%9B%B4%E9%80%9A\"><span class=\"toc-text\">硬盘直通</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85%E7%B3%BB%E7%BB%9F-1\"><span class=\"toc-text\">安装系统</span></a></li></ol></li></ol>","author":{"name":"Ryanhui","slug":"blog-author","avatar":"https://avatars1.githubusercontent.com/u/43368274?s=460&u=50a78f666213a52518d0076c1ca1cd9862076167&v=4","link":"/","description":"写博客，不过是孤芳自赏","socials":{"github":"https://weibo.com/wbgjh","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://github.com/Ranhuiryan","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{},"next_post":{"title":"训练深度学习网络的挑战和解决方法","uid":"a71e8b888458c8851815d0b96809bb00","slug":"训练深度学习网络的挑战和解决方法","date":"2019-12-27T09:46:48.000Z","updated":"2021-08-19T06:00:23.757Z","comments":true,"path":"api/articles/训练深度学习网络的挑战和解决方法.json","keywords":null,"cover":"https://image-assets.mihuashi.com/2021/08/15/09/FixrUuTczBtvQo8U9j-X2eCGMrzm.png","text":"Hands-on ml2 Ch.11 读书笔记。 Vanishing/Exploding Gradients在深度学习网络训练过程中，更深层次的网络梯度下降幅度越小，导致深层次的网络权重保持不变。或一些层梯度过大，每次权值更新的幅度很大（如 RNN）。导致不同层的学习速度相差较大...","link":"","photos":[],"count_time":{"symbolsCount":"1.9k","symbolsTime":"2 mins."},"categories":[{"name":"笔记","slug":"笔记","count":3,"path":"api/categories/笔记.json"}],"tags":[{"name":"读书笔记","slug":"读书笔记","count":3,"path":"api/tags/读书笔记.json"},{"name":"深度学习","slug":"深度学习","count":1,"path":"api/tags/深度学习.json"}],"author":{"name":"Ryanhui","slug":"blog-author","avatar":"https://avatars1.githubusercontent.com/u/43368274?s=460&u=50a78f666213a52518d0076c1ca1cd9862076167&v=4","link":"/","description":"写博客，不过是孤芳自赏","socials":{"github":"https://weibo.com/wbgjh","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://github.com/Ranhuiryan","zhihu":"","csdn":"","juejin":"","customs":{}}}}}